<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ø¸ÙˆÙ…Ø© Ø¥Ø¯Ø§Ø±Ø© Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø²ÙŠØªÙˆÙ†</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f4f3; font-family: 'Segoe UI', Tahoma, sans-serif; padding-bottom: 50px; }
        .header-section { background: linear-gradient(135deg, #4b5d16, #2e3b1a); color: white; padding: 20px; border-radius: 0 0 25px 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); margin-bottom: 20px; }
        .card { border-radius: 15px; border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .btn-action { margin: 5px; border-radius: 10px; font-weight: 500; flex: 1 1 45%; }
        .stats-box { background: #fff; border-right: 5px solid #4b5d16; padding: 15px; text-align: center; border-radius: 10px; }
        .modal-content { border-radius: 20px; border: none; }
        .modal-header { background-color: #4b5d16; color: white; border-radius: 20px 20px 0 0; }
        .farm-title { font-weight: bold; color: #fff; text-decoration: underline; cursor: pointer; font-size: 1.4rem; }
    </style>
</head>
<body>

<div class="header-section text-center">
    <h3 id="farmDisplayTitle" class="farm-title" onclick="renameFarm()">Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø±Ù‚Ù… (1)</h3>
    <select id="farmSelect" class="form-select w-75 mx-auto mt-2" onchange="switchFarm()">
        <option value="farm1">Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</option>
        <option value="farm2">Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option>
        <option value="farm3">Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option>
    </select>
</div>

<div class="container">
    <div class="row g-2 mb-4">
        <div class="col-6"><div class="stats-box"><span>Ù…Ø­ØµÙˆÙ„ (ÙƒØ¬Ù…)</span><h4 id="inv_kg" class="text-success">0</h4></div></div>
        <div class="col-6"><div class="stats-box" style="border-right-color: #8b4513;"><span>Ø²ÙŠØª (Ù„ØªØ±)</span><h4 id="inv_lt" style="color:#8b4513;">0</h4></div></div>
    </div>

    <div class="card p-3">
        <h6 class="mb-3">ğŸšœ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ© ÙˆØ§Ù„ØµÙŠØ§Ù†Ø©:</h6>
        <div class="d-flex flex-wrap justify-content-between">
            <button class="btn btn-success btn-action" onclick="openModal('Ø±ÙŠ')">ğŸ’§ Ø±ÙŠ</button>
            <button class="btn btn-success btn-action" onclick="openModal('ØªØ³Ù…ÙŠØ¯')">ğŸ§ª ØªØ³Ù…ÙŠØ¯</button>
            <button class="btn btn-success btn-action" onclick="openModal('Ø±Ø´')">ğŸ’¨ Ø±Ø´</button>
            <button class="btn btn-danger btn-action" onclick="openModal('ØµÙŠØ§Ù†Ø©')">ğŸ› ï¸ Ø£Ø¹Ø·Ø§Ù„</button>
            <button class="btn btn-dark btn-action" onclick="openModal('Ø­ØµØ§Ø¯')">ğŸ“¦ Ø­ØµØ§Ø¯</button>
            <button class="btn btn-primary btn-action" onclick="openModal('Ø¹Ù…Ø§Ù„Ø©')">ğŸ‘¥ Ø¹Ù…Ø§Ù„Ø©</button>
        </div>
    </div>

    <div class="card p-3">
        <h6>ğŸ‘¥ ÙƒØ´Ù Ø§Ù„Ø¹Ù…Ø§Ù„Ø© (Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©):</h6>
        <div class="table-responsive">
            <table class="table table-sm table-bordered text-center small">
                <thead class="table-light">
                    <tr><th>Ø§Ù„Ø¹Ø§Ù…Ù„</th><th>Ø­Ø¶ÙˆØ±</th><th>ØºÙŠØ§Ø¨</th><th>Ø¥Ø¬Ø§Ø²Ø©</th></tr>
                </thead>
                <tbody id="staffTable"></tbody>
            </table>
        </div>
    </div>

    <div class="card p-3">
        <h6>ğŸ“œ Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª:</h6>
        <div id="generalLogs" style="max-height: 250px; overflow-y: auto; font-size: 0.9rem;"></div>
    </div>
</div>

<div class="modal fade" id="actionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ©</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="modalInputs">
                    </div>
                <button class="btn btn-success w-100 mt-3" onclick="processData()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let currentType = '';
    let db = JSON.parse(localStorage.getItem('farm_system_v3')) || {
        farm1: { name: "Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰", logs: [], staff: {}, inv_kg: 0, inv_lt: 0 },
        farm2: { name: "Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©", logs: [], staff: {}, inv_kg: 0, inv_lt: 0 },
        farm3: { name: "Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©", logs: [], staff: {}, inv_kg: 0, inv_lt: 0 }
    };

    const myModal = new bootstrap.Modal(document.getElementById('actionModal'));

    function openModal(type) {
        currentType = type;
        document.getElementById('modalTitle').innerText = "ØªØ³Ø¬ÙŠÙ„: " + type;
        let inputs = document.getElementById('modalInputs');
        inputs.innerHTML = '';

        if (type === 'Ø¹Ù…Ø§Ù„Ø©') {
            inputs.innerHTML = `
                <input type="text" id="staffName" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„">
                <select id="staffStatus" class="form-select">
                    <option value="Ø­Ø¶ÙˆØ±">Ø­Ø¶ÙˆØ± âœ…</option>
                    <option value="ØºÙŠØ§Ø¨">ØºÙŠØ§Ø¨ âŒ</option>
                    <option value="Ø¥Ø¬Ø§Ø²Ø©">Ø¥Ø¬Ø§Ø²Ø© ğŸ–ï¸</option>
                </select>`;
        } else if (type === 'Ø­ØµØ§Ø¯') {
            inputs.innerHTML = `<input type="number" id="amount" class="form-control" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø¨Ø§Ù„ÙƒØ¬Ù…">`;
        } else {
            inputs.innerHTML = `<textarea id="details" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù‡Ù†Ø§..."></textarea>`;
        }
        myModal.show();
    }

    function processData() {
        let id = document.getElementById('farmSelect').value;
        let date = new Date().toLocaleString('ar-EG');

        if (currentType === 'Ø¹Ù…Ø§Ù„Ø©') {
            let name = document.getElementById('staffName').value;
            let status = document.getElementById('staffStatus').value;
            if (name) {
                if (!db[id].staff[name]) db[id].staff[name] = { Ø­Ø¶ÙˆØ±: 0, ØºÙŠØ§Ø¨: 0, Ø¥Ø¬Ø§Ø²Ø©: 0 };
                db[id].staff[name][status]++;
                db[id].logs.push({ d: date, t: "Ø¹Ù…Ø§Ù„Ø©", m: `${status}: ${name}` });
            }
        } else if (currentType === 'Ø­ØµØ§Ø¯') {
            let val = document.getElementById('amount').value;
            if (val) {
                db[id].inv_kg += parseFloat(val);
                db[id].logs.push({ d: date, t: "Ù…Ø­ØµÙˆÙ„", m: "Ø­ØµØ§Ø¯ " + val + " ÙƒØ¬Ù…" });
            }
        } else {
            let detail = document.getElementById('details').value;
            if (detail) db[id].logs.push({ d: date, t: currentType, m: detail });
        }
        
        save();
        myModal.hide();
    }

    function switchFarm() {
        let id = document.getElementById('farmSelect').value;
        document.getElementById('farmDisplayTitle').innerText = db[id].name;
        updateUI();
    }

    function renameFarm() {
        let id = document.getElementById('farmSelect').value;
        let newName = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯:", db[id].name);
        if (newName) { db[id].name = newName; save(); }
    }

    function updateUI() {
        let id = document.getElementById('farmSelect').value;
        let f = db[id];
        document.getElementById('inv_kg').innerText = f.inv_kg;
        document.getElementById('inv_lt').innerText = f.inv_lt;
        document.getElementById('farmDisplayTitle').innerText = f.name;

        let sTable = '';
        for (let name in f.staff) {
            sTable += `<tr><td>${name}</td><td>${f.staff[name].Ø­Ø¶ÙˆØ±}</td><td>${f.staff[name].ØºÙŠØ§Ø¨}</td><td>${f.staff[name].Ø¥Ø¬Ø§Ø²Ø©}</td></tr>`;
        }
        document.getElementById('staffTable').innerHTML = sTable;
        document.getElementById('generalLogs').innerHTML = f.logs.map(l => `
            <div class="border-bottom py-1"><b>${l.t}:</b> ${l.m} <small class="text-muted d-block">${l.d}</small></div>
        `).reverse().join('');
    }

    function save() {
        localStorage.setItem('farm_system_v3', JSON.stringify(db));
        updateUI();
    }

    // ØªØ­Ø¯ÙŠØ« Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„
    document.querySelectorAll('#farmSelect option').forEach(opt => opt.innerText = db[opt.value].name);
    updateUI();
</script>
</body>
</html>
