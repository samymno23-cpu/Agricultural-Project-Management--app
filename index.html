<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Olive Farm Royal V24</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --primary: #1e3d1a; --secondary: #c5a059; --bg: #f0f4f0; }
        body { background-color: var(--bg); font-family: 'Segoe UI', system-ui, sans-serif; padding-bottom: 90px; }

        /* Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ© */
        .header-royal { background: linear-gradient(135deg, var(--primary), #0d1a0b); color: white; padding: 40px 20px; border-radius: 0 0 50px 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        
        /* Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙˆØ§Ù„Ø´Ø¨ÙƒØ© */
        .btn-royal { background: white; border: none; border-radius: 25px; padding: 25px 10px; display: flex; flex-direction: column; align-items: center; gap: 12px; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .btn-royal i { font-size: 2rem; color: var(--primary); }
        .btn-royal span { font-weight: bold; color: #444; font-size: 0.9rem; }
        .btn-royal:active { transform: scale(0.9); background: #e8f5e9; }

        /* Ø§Ù„ÙƒØ±ÙˆØª */
        .card-stat { background: white; border-radius: 25px; padding: 20px; border: none; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .stat-num { font-size: 1.8rem; font-weight: 800; color: var(--primary); }

        /* Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© */
        .page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 2000; overflow-y: auto; padding: 25px; animation: slideIn 0.4s ease; }
        .page.active { display: block; }
        .page-title { color: var(--primary); font-weight: 800; border-bottom: 3px solid var(--secondary); display: inline-block; margin-bottom: 30px; }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ */
        .nav-bottom { background: white; position: fixed; bottom: 0; width: 100%; display: flex; justify-content: space-around; padding: 15px; border-radius: 30px 30px 0 0; box-shadow: 0 -5px 25px rgba(0,0,0,0.1); z-index: 1500; }
        .nav-btn { background: none; border: none; color: #aaa; transition: 0.3s; }
        .nav-btn.active { color: var(--primary); transform: translateY(-5px); }

        @keyframes slideIn { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

<div id="homePage">
    <div class="header-royal text-center">
        <h2 id="farmName" class="fw-bold">...</h2>
        <div id="weather" class="small opacity-75 mt-2"><i class="fas fa-location-dot"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...</div>
    </div>

    <div class="container mt-n5 px-3">
        <div class="row g-3 mb-4">
            <div class="col-6"><div class="card-stat text-center"><small class="text-muted">Ø§Ù„Ù…Ø­ØµÙˆÙ„</small><div id="kgVal" class="stat-num">0</div><small>ÙƒØ¬Ù…</small></div></div>
            <div class="col-6"><div class="card-custom"><div class="card-stat text-center"><small class="text-muted">Ø§Ù„Ù…Ø®Ø²Ù†</small><div id="stockVal" class="stat-num">0</div><small>ØµÙ†Ù</small></div></div></div>
        </div>

        <div class="row g-3">
            <div class="col-4"><button class="btn-royal w-100" onclick="openAction('Ø±ÙŠ')"><i class="fas fa-faucet-drip"></i><span>Ø±ÙŠ</span></button></div>
            <div class="col-4"><button class="btn-royal w-100" onclick="openAction('ØªØ³Ù…ÙŠØ¯')"><i class="fas fa-leaf"></i><span>ØªØ³Ù…ÙŠØ¯</span></button></div>
            <div class="col-4"><button class="btn-royal w-100" onclick="openAction('Ø±Ø´')"><i class="fas fa-spray-can-sparkles"></i><span>Ø±Ø´</span></button></div>
            <div class="col-4"><button class="btn-royal w-100" onclick="openAction('ØªÙ‚Ù„ÙŠÙ…')"><i class="fas fa-scissors"></i><span>ØªÙ‚Ù„ÙŠÙ…</span></button></div>
            <div class="col-4"><button class="btn-royal w-100" onclick="openAction('Ø´ØªÙˆÙŠØ©')"><i class="fas fa-snowflake"></i><span>Ø´ØªÙˆÙŠØ©</span></button></div>
            <div class="col-4"><button class="btn-royal w-100" onclick="openAction('Ø£Ø¹Ø·Ø§Ù„')"><i class="fas fa-screwdriver-wrench"></i><span>Ø£Ø¹Ø·Ø§Ù„</span></button></div>
            <div class="col-4"><button class="btn-royal w-100" onclick="openAction('Ø­ØµØ§Ø¯')"><i class="fas fa-basket-shopping"></i><span>Ø­ØµØ§Ø¯</span></button></div>
            <div class="col-4"><button class="btn-royal w-100" onclick="openPage('staffPage')"><i class="fas fa-user-check"></i><span>Ø¹Ù…Ø§Ù„Ø©</span></button></div>
            <div class="col-4"><button class="btn-royal w-100" onclick="openAction('Ø£Ø®Ø±Ù‰')"><i class="fas fa-ellipsis"></i><span>Ø£Ø®Ø±Ù‰</span></button></div>
        </div>
    </div>
</div>

<div id="actionPage" class="page text-center">
    <h3 class="page-title" id="actionTitle">...</h3>
    <div id="actionFields" class="mb-4"></div>
    <div class="card-stat mb-4">
        <label class="fw-bold d-block mb-2">ğŸ“¸ Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input type="file" id="photo" class="form-control rounded-pill">
    </div>
    <div class="d-grid gap-3">
        <button class="btn btn-success p-3 rounded-pill fw-bold fs-5" onclick="submitAction()">ØªØ£ÙƒÙŠØ¯ ÙˆØ­ÙØ¸</button>
        <button class="btn btn-outline-dark p-2 rounded-pill" onclick="closePages()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div id="stockPage" class="page">
    <h3 class="page-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²Ù†</h3>
    <div class="card-stat mb-4">
        <input type="text" id="sItem" class="form-control mb-2 rounded-pill" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³Ù…Ø§Ø¯">
        <input type="number" id="sQty" class="form-control mb-3 rounded-pill" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
        <button class="btn btn-primary w-100 rounded-pill" onclick="saveStock()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø®Ø²Ù†</button>
    </div>
    <div id="stockDisplay"></div>
</div>

<div id="staffPage" class="page">
    <h3 class="page-title">Ø¯ÙØªØ± Ø§Ù„Ø¹Ù…Ø§Ù„Ø©</h3>
    <div class="card-stat mb-4 text-center">
        <input type="text" id="worker" class="form-control mb-3 rounded-pill" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„">
        <div class="btn-group w-100 mb-3">
            <button class="btn btn-outline-success" onclick="logW('Ø­Ø¶ÙˆØ±')">Ø­Ø¶ÙˆØ±</button>
            <button class="btn btn-outline-danger" onclick="logW('ØºÙŠØ§Ø¨')">ØºÙŠØ§Ø¨</button>
            <button class="btn btn-outline-primary" onclick="logW('Ø¥Ø¬Ø§Ø²Ø©')">Ø¥Ø¬Ø§Ø²Ø©</button>
        </div>
    </div>
    <div id="staffDisplay"></div>
</div>

<div id="farmsPage" class="page">
    <h3 class="page-title">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</h3>
    <div id="farmsList" class="mb-4"></div>
    <input type="text" id="newF" class="form-control mb-2 rounded-pill" placeholder="Ø§Ø³Ù… Ù…Ø²Ø±Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©">
    <button class="btn btn-success w-100 rounded-pill" onclick="addF()">+ Ø¥Ø¶Ø§ÙØ©</button>
</div>

<div id="archivePage" class="page">
    <h3 class="page-title">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
    <button class="btn btn-dark w-100 mb-4 rounded-pill" onclick="makePDF()">ØªØ­Ù…ÙŠÙ„ PDF Ø¹Ø±Ø¨ÙŠ</button>
    <div id="archiveList"></div>
</div>

<div id="editPage" class="page">
    <h3 class="page-title">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h3>
    <textarea id="editTxt" class="form-control mb-4" rows="5"></textarea>
    <button class="btn btn-success w-100 rounded-pill" onclick="updateLog()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
</div>

<div class="nav-bottom">
    <button class="nav-btn active" onclick="closePages(); setActiveNav(this)"><i class="fas fa-home fs-4"></i></button>
    <button class="nav-btn" onclick="openPage('farmsPage'); setActiveNav(this)"><i class="fas fa-layer-group fs-4"></i></button>
    <button class="nav-btn" onclick="openPage('stockPage'); setActiveNav(this)"><i class="fas fa-warehouse fs-4"></i></button>
    <button class="nav-btn" onclick="openPage('archivePage'); setActiveNav(this)"><i class="fas fa-clock-rotate-left fs-4"></i></button>
</div>

<script>
    const KEY = 'OLIVE_ROYAL_2026';
    let db = JSON.parse(localStorage.getItem(KEY)) || { cur: 'f1', farms: { f1: { name: "Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø²ÙŠØªÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", logs: [], kg: 0, stock: {}, staff: [] } } };
    let curOp = ''; let editIdx = null;

    function openAction(op) {
        curOp = op; document.getElementById('actionTitle').innerText = "ØªØ³Ø¬ÙŠÙ„: " + op;
        const fields = document.getElementById('actionFields');
        const f = db.farms[db.cur];
        if (op === 'ØªØ³Ù…ÙŠØ¯') {
            let o = Object.keys(f.stock).map(k => `<option value="${k}">${k} (Ù…ØªØ§Ø­: ${f.stock[k]})</option>`).join('');
            fields.innerHTML = `<select id="v1" class="form-select mb-3 rounded-pill">${o || '<option>Ø§Ù„Ù…Ø®Ø²Ù† ÙØ§Ø±Øº</option>'}</select><input type="number" id="v2" class="form-control rounded-pill" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">`;
        } else if (op === 'Ø­ØµØ§Ø¯') {
            fields.innerHTML = `<input type="number" id="v1" class="form-control rounded-pill" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø¨Ø§Ù„ÙƒØ¬Ù…">`;
        } else {
            fields.innerHTML = `<textarea id="v1" class="form-control rounded-4" rows="6" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù€ ${op}..."></textarea>`;
        }
        openPage('actionPage');
    }

    function submitAction() {
        const f = db.farms[db.cur]; let msg = "";
        const v1 = document.getElementById('v1').value;
        const v2 = document.getElementById('v2')?.value;

        if (curOp === 'ØªØ³Ù…ÙŠØ¯') {
            if (f.stock[v1] >= v2) { f.stock[v1] -= v2; msg = `Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ${v2} Ù…Ù† ${v1}`; } else { alert("Ø¹Ø°Ø±Ø§Ù‹ Ø§Ù„Ù…Ø®Ø²Ù† Ù„Ø§ ÙŠÙƒÙÙŠ!"); return; }
        } else if (curOp === 'Ø­ØµØ§Ø¯') { f.kg += parseFloat(v1 || 0); msg = `Ø­ØµØ§Ø¯ ${v1} ÙƒØ¬Ù…`; }
        else { msg = v1; }

        f.logs.push({ d: new Date().toLocaleString('ar-EG'), t: curOp, m: msg });
        save(); closePages();
    }

    function renderHome() {
        const f = db.farms[db.cur];
        document.getElementById('farmName').innerText = f.name;
        document.getElementById('kgVal').innerText = f.kg;
        document.getElementById('stockVal').innerText = Object.keys(f.stock).length;
    }

    function renderArchive() {
        const f = db.farms[db.cur];
        document.getElementById('archiveList').innerHTML = f.logs.map((l, i) => `
            <div class="card-stat mb-3 d-flex justify-content-between align-items-center">
                <div><span class="badge bg-success mb-1">${l.t}</span><br><b>${l.m}</b><br><small class="text-muted">${l.d}</small></div>
                <button class="btn btn-sm btn-outline-primary rounded-pill" onclick="setupEdit(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
            </div>
        `).reverse().join('');
    }

    function setupEdit(i) { editIdx = i; document.getElementById('editTxt').value = db.farms[db.cur].logs[i].m; openPage('editPage'); }
    function updateLog() { db.farms[db.cur].logs[editIdx].m = document.getElementById('editTxt').value; save(); openPage('archivePage'); }

    function logW(s) {
        let n = document.getElementById('worker').value; if(!n) return;
        db.farms[db.cur].staff.push({ n, s, d: new Date().toLocaleDateString('ar-EG') });
        save(); renderStaff(); document.getElementById('worker').value = '';
    }
    function renderStaff() {
        document.getElementById('staffDisplay').innerHTML = db.farms[db.cur].staff.map(w => `<div class="card-stat mb-2 small d-flex justify-content-between"><span>${w.d}</span><b>${w.n}</b><span class="text-primary">${w.s}</span></div>`).reverse().join('');
    }

    function saveStock() {
        let n = document.getElementById('sItem').value, q = document.getElementById('sQty').value;
        if(n && q) { db.farms[db.cur].stock[n] = (db.farms[db.cur].stock[n] || 0) + parseFloat(q); save(); renderStock(); document.getElementById('sItem').value=''; document.getElementById('sQty').value=''; }
    }
    function renderStock() {
        document.getElementById('stockDisplay').innerHTML = Object.keys(db.farms[db.cur].stock).map(k => `<div class="card-stat mb-2 d-flex justify-content-between"><b>${k}</b><span class="text-success">${db.farms[db.cur].stock[k]} ÙƒØ¬Ù…</span></div>`).join('');
    }

    function renderFarms() {
        document.getElementById('farmsList').innerHTML = Object.keys(db.farms).map(id => `<div class="card-stat mb-2 d-flex justify-content-between align-items-center ${id==db.cur?'border border-success':''}" onclick="selF('${id}')"><b>${db.farms[id].name}</b> ${id==db.cur?'<i class="fas fa-check-circle text-success"></i>':''}</div>`).join('');
    }
    function selF(id) { db.cur = id; save(); closePages(); }
    function addF() { let n = document.getElementById('newF').value; if(n) { let id = 'f'+Date.now(); db.farms[id] = { name:n, logs:[], kg:0, stock:{}, staff:[] }; db.cur = id; save(); closePages(); } }

    function openPage(id) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(id).classList.add('active'); if(id==='archivePage') renderArchive(); if(id==='staffPage') renderStaff(); if(id==='stockPage') renderStock(); if(id==='farmsPage') renderFarms(); }
    function closePages() { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); renderHome(); }
    function setActiveNav(btn) { document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
    function save() { localStorage.setItem(KEY, JSON.stringify(db)); }

    function makePDF() {
        const f = db.farms[db.cur];
        let h = `<div dir="rtl" style="font-family:Arial; padding:20px"><h2>ØªÙ‚Ø±ÙŠØ±: ${f.name}</h2><table border="1" style="width:100%; border-collapse:collapse; text-align:center"><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th></tr>`;
        f.logs.forEach(l => h += `<tr><td>${l.d}</td><td>${l.t}</td><td>${l.m}</td></tr>`);
        html2pdf().from(h + "</table></div>").save('Farm_Report.pdf');
    }

    navigator.geolocation.getCurrentPosition(p => {
        fetch(`https://api.open-meteo.com/v1/forecast?latitude=${p.coords.latitude}&longitude=${p.coords.longitude}&current_weather=true`)
        .then(r => r.json()).then(d => document.getElementById('weather').innerHTML = `<i class="fas fa-cloud-sun"></i> Ø§Ù„Ø­Ø±Ø§Ø±Ø©: ${d.current_weather.temperature}Â°C | Ø·Ù‚Ø³ Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ù…Ù…ØªØ§Ø²`);
    });

    renderHome();
</script>
</body>
</html
